---
title: "A statistical challenge"
subtitle: "Data science for the real world"
author: "Jacinta Kong"
date:  "`r format(Sys.time(), '%d %b %Y')`"
output:
  tufte::tufte_html:
   tufte_features: ["italics"]
---

```{r setup, include=FALSE}
library(tufte)
# invalidate cache when the tufte version changes
knitr::opts_chunk$set(tidy = TRUE, cache.extra = packageVersion('tufte'), echo = TRUE, warning = F, message = F)
options(htmltools.dir.version = FALSE)
```


# R is for Reproducibility

In class, we have introduced the concept of reproducibility and the advantages of writing and saving your code. But we can take it further. Look at this document. It is a HTML document, like a website. You can view it in your browser. I made it in RStudio using a package called `Rmarkdown`. `Rmarkdown` does a lot of things we won't get into here but the most important thing it does is generate documents integrating text and R code. It is not a word processor where you see the formatting of what you type in real time, like Google Docs or Microsoft Word. Instead, it uses markdown as a means of formatting text (called markups). Markdown permits simple formatting like **bold text** or *italics*, headers are formatted using # [insert header text here]. There is a nice cheat sheet available on the RStudio website. You write your text and its markup, then click "Knit" and your document is produced.  

 `r tufte::margin_note("Markdown is also widely used online. You can use markdown in WhatsApp, Reddit, Github & Stack Exchange. You can make PDFs or word documents, websites, books & presentations in Rmarkdown. People even write theses.")`
 
Markdown is designed for writers to write with minimal distractions because they don't need to mess with formatting. We don't teach you Rmarkdown or markdown at this level but it is something you may encounter later in your degree and it is a useful skill to take forward in your career. 

***

# Data science in the real world

Undergrad stats classes may seem like a mess but, truthfully, everything has been prepared to function as seamlessly in class as possible. The data is neat and tidy; the code is bug-free; you have been given instructions on what to do.   

`r tufte::margin_note("Clean data first time is unrealistic")`

In the real world, things aren't always this clear cut. Science and making discoveries relies on problem solving and statistics plays a large part in that. As science moves towards open data sharing, you may have to collaborate with others or get datasets from other sources. Often, these datasets are not neat or tidy and we have to make sure the data are in an appropriate format for the statistical tests we want to do. 

***

# A statistical challenge

Here, I am offering a standing challenge. This challenge is entirely optional and beyond the expectations of this class but it will introduce you to things that **will** be covered later in your degree. I have uploaded a dataset to Blackboard alongside this file and there is a research question to be answered at the end of this document.


> **The first person to email me a rendered HTML document & the original Rmarkdown file (.rmd) answering the research question will receive a prize**



***

# Background

In 2000, Professor Eric Kandel received the Nobel Prize in Physiology or Medicine for pioneering research into the neurological basis of memory and behaviour, alongside two other neuroscientists. Kandel and colleagues' used sea hares, specifically *Aplysia californica*, as a model organism to study memory storage. The advantage of sea hares is that they have large neurons arranged in a simple neural network that make them easy to observe in the lab.  

![The California sea hare showing its ink production, a type of chemical defence, Wikicommons](https://upload.wikimedia.org/wikipedia/commons/e/ef/Aplysia_californica.jpg)

One of the defensive mechanisms of sea hares is to withdraw their head and body when stimulated, e.g. a predator trying to eat it. This is a reflex. Kandel and colleagues examined whether this reflex could be modified by learning and whether sea hares had short term and long term memory. One outcome of learning is that sea hares become habituated to a stimulus - that is, there is a decrease in the response with repeated exposure to the stimulus. 

For something to be considered a general response, it needs to be shown in more than one species. To test the generality of habituation in sea hares, I repeatedly poked wedge sea hares (*Dolabella auricularia*) and measured the duration of their withdrawal reflex, over two days. I also recorded their mass, body length and colour. 

![An example of a withdrawal response](https://www.gbri.org.au/Portals/0/Images/Classes/2012/s4229005/withdrawal.jpg)

<iframe width="560" height="315" src="https://www.youtube.com/embed/jF5uWzNWYe4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

On the first day, sea hares were poked and the duration of the withdrawal response repeated over 10 sequential trials (short time scales). This sequence was repeated 30 min and 60 mins later from the initial test (long time scales). The experiment was repeated on the second day (longer time scales).


## Submission

In the submission I want a HTML rendered document and the original markdown file answering the question:

> **Do sea hares show habituation?**
> **Does learning, if it occurs, occur on long or short time scales?**

Think about:

* What is the hypothesis and prediction?
* What is the statistical test?
* Does the graph allow the reader to evaluate the hypothesis?
* Do the results lend evidence to the hypothesis?

There should be a paragraph written like a scientific abstract with one sentence each for the introduction, methods, results and discussion.

`r tufte::margin_note("Nature guide to writing an abstract: https://www.nature.com/scitable/content/an-effective-abstract-14194316/")`
`r tufte::margin_note("See below for Tidyverse & Rmarkdown hints")`

It's up to you how to analyse the data, using what you've learnt in class. There isn't really a wrong answer but some approaches are better than others. As with anything, any statistical approach should be justified.

There are some conditions for submission to be valid:

1. The Rmarkdown file must run and render the exact same HTML document submitted
2. The R code must be written in `Tidyverse` style and presented following the `Tidyverse` style guide. Not base R as we have been doing in class. Base R is accepted if there is no `Tidyverse` equivalent. 
3. The stats must be correct and properly reported like a scientific paper 
4. There should be one graph with proper legend and caption and one table with a proper caption
5. Use pipes 

> **The deadline for submissions is midnight 30th November 2019.**

***

# Tidyverse 

There are many ways of doing the same thing in R. `Tidyverse` is a collection of R packages that follow a similar philosophy of design, grammar and data handling that does many things that base R or other packages does. One of the benefits of `Tidyverse` is that it follows the 'grammar of graphics' and uses piping to make code easier to use. 

`r tufte::margin_note("There are other benefits under the hood that you don't need to be concerned with")`

## Piping

Piping is a way of formatting your code in an ordered sequence to be fed into a function, rather than nested within each function. This becomes really handy if you are doing multiple things to a dataset. It is designated using the operator `%>%` which tells R to pipe the data 

![](https://pbs.twimg.com/media/EEn5cPNWwAA4LP4.jpg)
`r tufte::margin_note("An example of piping from Twitter (@andrewheiss). Which example is easier to follow?")`

## Graphing using ggplot2

`ggplot2` is a package for making graphs. The syntax follows `Tidyverse` and is very different to base R. 
Notice that you tell R which variables to use and what type of graph to plot as separate commands. You also tell R what goes on the x axis first, then the y axis, which is the opposite to base R. It goes like this:

```
ggplot(dataset, aes(x axis variable, y axis variable)) +
geom_point() # for plotting points. Other types of graphs typically follow the syntax geom_X

```
`r tufte::margin_note("aes stands for aesthetics")`

```{r fig-margin, fig.margin = TRUE, fig.show='hold',fig.cap = "The ggplot2 example coded to the left and the base R equilvalent", fig.width=3.5, fig.height=3.5, cache=TRUE, message=FALSE}
library(ggplot2)
ggplot(iris, aes(Petal.Length, Petal.Width, color = Species)) +
  geom_point() + 
  geom_smooth() +
  theme_classic() +
  theme(legend.position = 'bottom') 
plot(Petal.Width ~ Petal.Length, iris, col = Species)
```


There is a lot of flexibility in the colours, layouts and design of the graph which is partly why ggplot2 is popular.

## Installing tidyverse

Install tidyverse with `install.packages("tidyverse")`. Note that you cannot make PDF files without also installing TeX, which is a whole other word processing system widely used in mathematics, physics and publishing. 

`r tufte::margin_note("Ever wondered how papers or books are formatted? Copyeditors use TeX")`

## Resources

* There is a HUGE amount of `Tidyverse` resources online
* Find the style guide here: https://style.tidyverse.org/index.html
* The recommended R textbook "Getting Started with R" by Beckerman, Childs & Petchey uses `Tidyverse` in their examples (Hint, Hint)


***

# Some Rmarkdown hints

## Tables

The package `knitr` is integral for `Rmarkdown` behind the scenes. 

You can use the `kable()` function from the **knitr** package to format tables. The table captions are placed in the margin like figures in the HTML output.

```{r}
knitr::kable(
  iris[1:6,], caption = 'A subset of iris'
)
```


## Headings

First and second-level headings are written as `#` and `##`. That is, ## is a subheading of #. The more `#` used, the smaller the header.

