---
title: "Statistical modelling Part 1"
output: 
    learnr::tutorial:
      theme: readable
      progressive: true
      allow_skip: false
runtime: shiny_prerendered
subtitle: "2021"
description: "2021 Practical 4"
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

## How to use this tutorial

You can interact with this tutorial through the Tutorial tab in RStudio. This window can be resized and expanded. However, I recommend clicking the pop out button (in between the home icon and the stop icon) to open the tutorial in a separate window. 

***

This tutorial has interactive code chunks that you can use to enter `R` code. Try it:  
*Here's a simple exercise with an empty code chunk provided for entering the answer. Click __Run Code__ to run the code. The __Hint__ button will tell you a hint.*

Write the R code required to add two plus two (the answer should be 4):

```{r test, exercise=TRUE, exercise.eval=TRUE}

```

```{r test-hint}
You need a + somewhere. You do not need =
```

```{r test-solution}
2+2
```

***

There are also quizzes to test your understanding. **These are not part of the CA**. The questions are meant to check you understand the material. The CA is accessed separately.

*Here's a quiz. Try it out to see how it works. Click __submit__ and it will tell you what you got correct. What happens when you put an incorrect answer in?*
```{r test-quiz}
quiz(
question(
  "What colour is a red squirrel?",
  answer("Red", correct = TRUE),
  answer("Brown"),
  answer("Grey"),
  answer("Black"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question_text(
  paste("What is the answer to the above coding exercise?"),
  answer("4", correct = TRUE),
  allow_retry = TRUE
)
)
```

***

Well done!  
Your answers should be saved if you open the tutorial again. You can reset your answers by clicking **Start Over** at the end of the menu. 

Click **Next Topic** to progress to the practical instructions.  
You can navigate between topics using the buttons or the menu. You may not be able to skip ahead if you haven't completed all the exercises.

***

## Introduction to statistical modelling

Welcome! In this practical and in three lectures (with Dr Jacinta Kong), we will be looking at statistical modelling. 

In these sessions we will focus on the practical aspects of *applying* statistics (implementation & interpretation) with real data - not on the theory or mathematical proofs. Equations are kept to a minimum (promise). R is the tool most data scientists use to conduct statistics so that is what we will use too - we have also progressed beyond the realm of doing stats by hand (sorry, t-test).

The practicals and lectures will feed off each other so you should be up to date. This practical comes first so we will start with an introduction to statistical modelling that we will continue in the lectures.

### What is statistical modelling?

Statistical modelling is an umbrella term in statistics, it can refer to many things and even a philosophical way of thinking about data.

A definition:

> Statistical models are logical mathematical or statistical descriptions of what we believe to be important in a biological system. 

Philosophically, biologists use models to describe the real world in (relatively!) simple ways. Models are (often abstract or reductionist) representations of reality.

We use models to:

 * Make sense of a complex and messy real world and its data
     * Formulate new theories
 * Test our understanding of a biological system
     * Formulate hypotheses
     * Make predictions
 * Make evidence-based decisions
     * Run simulations - "what if...?", what happens if we change something?
 
As part of the Scientific Method, we can compare our model with real world data. If our models are wrong, we can adjust them and formulate new hypotheses. Thus, *all models are wrong but some are useful*.
 
### Types of models

Models can be characterised in several ways.

Depending on what they describe:

 * **Theoretic models** describe processes - explored here
 * **Empirical models** describe data - explored in lectures

Some biological systems can be described both ways.

***
 
Models can be placed on a spectrum of simple to complex, and specific to general.

   * A simple and general model are analytical models like functional responses (discussed here)
   * A simple and specific model are linear regression models (discussed in lectures)
   * A complex and general model are global climate forcasting models
   * A complex and specific model are phenomenological models (e.g. growth of a species)
 
***

Models can also be described based on their precision, realism and generality. But these trade-off - No one model can perfectly capture all these qualities.
 
> The best model to use depends on the intended question.

***

*All types* of models are based on assumptions or require information about the biological system. This has some limitations:

 * The assumptions may be too simplistic for complex systems (most biological systems)
 * We may not know enough information about the biological system to make a good model
 * The model is too reductionistic or abstract (i.e. unrealistic)
 * There is uncertainty we cannot eliminate
 
We will see these concepts again in the lectures and in practice here.

```{r modelling-quiz}
quiz(
question(
  "Which of these questions would not need a statistical model to answer?",
  answer("All of these involve statistical models", correct = TRUE),
  answer("Deciding where to invest finances"),
  answer("Estimating when students can return to face-to-face learning"),
  answer("Forecasting tomorrow's weather"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question_radio("Statistical models aim to accurately and precisely describe reality as it is",
  answer("False", correct = TRUE),
  answer("True"),
  allow_retry = TRUE
)
)
```

***

## Practical information

In these practicals we will look at a theoretic model of a pathogen response (predator-prey interaction). The aim is to understand how statistical models can be applied to biological data. 

The majority of this practical will focus on the practicalities of designing experiments and collecting data, which we covered earlier in the module. The data collected in this practical must be submitted to Blackboard and will be used in the next practical.

***

### Learning objectives

This practical is split into three parts with distinct learning objectives (recommended time to spend):

Part A: Building a theoretic model (40 mins)  
**Learning objectives:**

 * Know how a biological process can be described by a statistical model 
 * Understand how statistical models are applied to answer real world biological questions

Part B: Designing an experiment (40 mins)  
**Learning objectives:**

 * Apply your knowledge about experimental design and hypothesis formulation to a biological problem in practice

Part C: Collecting data (1.5 hours)  
**Learning objectives:** 

 * Know how to run a simulation of a model and extract data 
 * Know how to organise a spreadsheet and fill in a spreadsheet with data following the principles of tidy data
 
You will be uploading your data to Blackboard that will be checked as part of the CA. In the next practical we will be analysing the aggregated & anonymised class data set and using that to answer CA questions.

***

### Continuous Assessment

I recommend to do the CA *after* finishing this practical. Give yourself 30 mins to do the CA.

The CA is worth 10% and is due at the end of the prac.  
There are 9 questions to answer for 1 mark each.  
1 mark is from a quality check of your data.  
There is a total of 10 marks. 

The CA aims to assess your understanding of the concepts in this practical and your ability to apply the concepts in practice.

***

### A note on problem solving

In programming, it's *really easy* to make mistakes like typos so that code doesn't work. That is no means a reflection on you or your ability to code/learn. If your code is not working take a moment to breathe.  

Then, check whether it's a minor thing like a spelling mistake, or a missing quotation mark or bracket, or whether your cases don't match.

Next, check whether you have missed a step. Re-read the instructions again.

*These two steps are the majority of encountered errors. They are not a big deal and are easily corrected*

Next, try to articulate in words to yourself what you aim to do, what you expect to see if it worked, what you did leading up to this point and what you think is happening to cause the error. (This is called the rubber duck method - like you are explaining your problems to a rubber duck.)

If there's an error message, read it. Error messages are the computer telling you what's wrong. Try googling the entire error message to see what other people have said.

Finally, ask a person/demonstrator as a last step. It's easy to jump ahead to this step but try not to - you may gain a deeper understanding if you try to figure it out independently. The same with reading and digesting the prac material - maybe you haven't read this sentence because tl;dr but you should because the CA will test your reading comprehension. My favourite dinosaur is diplodocus. The goal of learning to code is about the process, not the end result.

One of the hard things about troubleshooting programming is that it's not clear what the problem is to an outsider (see step 3). So when describing your problem, be comprehensive & give context. Show the entire error message, not just parts of it. Trace your steps leading up to it. You see this a lot on online forums - questions don't get answered if there isn't provide enough information or a reproducible example.

The more information you provide, the more information people have to help you (we cannot read minds). That's why we might ask you to provide more information or ask further questions to troubleshoot. The first things we would check are the steps above (minor human errors), so if you've done those you can say this is what I've already done and I've ruled out those causes. 

Programming is **trial and error**. You wouldn't expect to get it on the first try. And that's OK - it's part of the process.

> When in doubt, try turning it on and off again

***

##

```{r dino-quiz}
question(
  "What is Jacinta's favourite dinosaur?",
  answer("Diplodocus", correct = TRUE, message = "Clever student!"),
  answer("Tyrannosaurus rex"),
  answer("Velociraptor"),
  answer("Spinosaurus"),
  random_answer_order = TRUE
)
```

***

## Part A: Theoretic models

In the previous practical you looked at a killer T cell digesting a pathogen. This infection response is a biological process and is analogous to a predator (e.g. a lion) hunting a prey (e.g. zebra), or a robot (a "predator") cleaning up an oil spill (its "prey").

You started to compose a Scratch model. Although the Scratch model comprises of pictures and code blocks, under the hood these blocks represent computer code, and more abstractly a mathematical processes. Thus, the Scratch model is an implementation of a statistical model of a biological system - the infection response.

This model was simple - maybe, too simple to be realistic. The killer T cell captured any and all pathogens touching it whereas in reality, a killer T cell may only target a few pathogens at a time or sequentially. This is also true for animal predators who hunt.

We can conceptualise a more realistic representation of an infection response, or more abstractly a predator-prey interaction. By breaking down what we observe to be important about the infection response into variables and assumptions, we can build our own theoretic model (describing a process) of an infection response from the ground up.


***

### What is an infection response?

In an infection response we have two variables:

1. Killer T cells
2. Pathogens

If we think about what we consider to be important in an infection response, we can make the following statements, or assumptions, about the infection response:

* A killer T cell randomly searches for pathogens
* A killer T cell can only "search" a fixed area per unit time (search rate)
* A killer T cell can only destroy one pathogen at a time - it must "process" (i.e. digest) the pathogen before it can begin searching for the next one (handling time)
    * Handling time and searching activity are mutually exclusive
* Pathogens randomly move around independently of the killer T cell (e.g. it does not slow down or speed up when the T cell is near)
* Both the killer T cell and the pathogen move at the same speed and at a constant speed
* Both the killer T cell and the pathogen only move within a fixed area (e.g. the body), they cannot leave.
* The numbers of killer T cells and pathogens are fixed at the start of the simulation (i.e. they do not replicate while the model is running, pathogen numbers can only decrease, killer T cell numbers stay the same)
* Each infection response lasts a fixed amount of time (total time)

**Would you agree with these statements? Or are they too simplistic of a complex biological system?**  

```{r assumptions}
quiz(caption = "First, a quick quiz on variables",
question(
  "What are the variables for a statistical model for a hawk predating on a pidgeon?",
  answer("The hawk and the pidgeon", correct = TRUE),
  answer("The hawk only"),
  answer("The pidgeon only"),
  answer("Neither the hawk or the pidgeon"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question(
  "What does it mean when the killer T cell and the pathogen are described as variables?",
  answer("They are the components of interest in our infection model that change with each run of the model", correct = TRUE),
  answer("The numbers of pathogens never change in any scenario"),
  answer("The numbers of killer T cells never change in any scenario"),
  answer("They are unknown to us"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
)
```

If you thought our model is too simplistic, you are probably right *but* in modelling philosophy some degree of simplification or abstraction is perfectly acceptable because *models are only representations of reality*, they are not meant to copy the real world right down to the minutiae.

> Thus, one application of models is to consider them as hypotheses of biological systems - what we think are important components of the system

If our model doesn't match what we observe from empirical data, that's OK! We can refine our model (our hypothesis) to better match what we observe. **That's the Scientific Method.**

We will see in the lectures that there is a trade-off between precision, generality and realism of models - there is no, one "perfect" model.

> To paraphrase a quote: all models are wrong but some can be useful

***

Infection responses, predator-prey interactions...they can be generally classified as **functional responses**. Luckily for us, there is already a well known mathematical model of functional response that we can use (a theoretic model).

There are multiple types of functional responses (labelled with Roman numerals). Each of these models represents a *different hypothesis* about functional responses and describes a *different relationship* between our two variables (the killer T cell and the pathogen). The assumptions we make above are based on a Type II functional response model and is the one most appropriate for an infection response scenario. We won't discuss the other types. 

***

```{r models-quiz}
question(
  "Which of these is not a rational for using statistical models on biological data?",
  answer("To disprove a hypothesis", correct = TRUE, message = "Scientists don't 'prove' hypotheses"),
  answer("To make sense of biological patterns"),
  answer("To make new theories"),
  answer("To guide future research"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
```

***

### A Type II functional response

**How would you describe the below Type II relationship in words in a results section of a lab report?**  

```{r funct_resp, echo=FALSE, fig.cap= "Type II functional response of an infection response"}
prey <- seq(0, 60, 5)
type2 <- (prey*0.7)/(1+(prey*0.7*0.15))
plot(type2~ prey,
     type = 'l',
     lwd = 4,
     xlab = "Pathogen density", ylab = "Number of pathogens destroyed",
     xaxt='n', yaxt='n')
```


Maybe something like:   
"The number of pathogens destroyed rapidly increases at low pathogen densities and gradually plateaus to a maximum number of pathogens destroyed at higher pathogen densities."

The mathematical model of the figure above is:

$$H_a=\ \frac{a\times H\times T_{total}}{1+a\times H\times T_h}$$

We won't go into how this equation is derived but know that it is based on the assumptions of the infection response described earlier. You can see the full derivation in the Appendix if you are interested.

Let's go through what the letters and numbers mean and how they link to our model assumptions.

 * $H$ is the number of pathogens within a fixed area (pathogen density, number per area). This is our predictor variable that we decide before our simulation.
 * $a$ is the search area per unit time of a T cell. This is a parameter that we do not know and that we calculate from our data.
 * $H_a$ is the number of pathogens captured. We record this at the end of our simulation as our response variable.
 * $T_{total}$ is the total time a killer T cell spent hunting pathogens (time). This is a constant that we decide before we start the simulation based on our assumptions.
 * $T_h$ is the time a killer T cell spends digesting a single pathogen (time per pathogen). This is a parameter that we do not know and that we calculate from our data. In functional response models, this is called handling time.

You'll see that we know the value of some of these parameters already and some we need to calculate from our data.

> Variables or parameters? Which is which in our model?

### Quiz

```{r constants}
question_checkbox(
  "Which of these parameters are unknowns we need to calculate from our data? Select all that apply",
  answer("Ha"),
  answer("Th", correct = TRUE),
  answer("T total"),
  answer("a", correct = TRUE),
  answer("H"),
  allow_retry = TRUE,
  random_answer_order = TRUE
)
```

### Finding our unknown parameters

How do we estimate these unknown parameters from our data (e.g from the figure above)?  
Actually, the hyperbolic nature of the Type II makes it challenging to extract this information - and certainly beyond the expectations of this module. *But* we can use mathemagics to turn this hyperbolic relationship into a straight line by a process called *linearising*. And straight lines are easier to manipulate or interpret - something we expect you to be able to do in this module.

The linearised Type II equation is: 
$$\frac{1}{H_a}=\ \frac{1}{a}\times\frac{1}{H\times T_{total}}+\frac{T_h}{T_{total}}$$
Again, we won't go though how this is derived in detail but you *do* need to know what this equation is telling you:

 * $\frac{1}{H_a}$ is the inverse of our response variable - the number of pathogens destroyed 
 * $\frac{1}{a}$ is the inverse of our unknown search rate parameter
 * $\frac{1}{H \times T_{total}}$ is the inverse of our predictor variable (pathogen density) and the total infection response time
 * $\frac{T_h}{T_{total}}$ is our unknown handling time divided by the total infection response time

**Does the overall structure of the equation look familiar to you? (maybe from high school maths)**

The graph looks like this:
```{r tyepe2line, echo = FALSE, fig.cap= "Linearised type II functional response of an infection response"}
prey <- seq(0, 0.25, 0.01)
type2 <- seq(0, 1, length.out = length(prey))
plot(type2 ~ prey , type = 'l', lwd = 4, ylab = "1/Ha, Pathogens destroyed", xlab = "1/H Total time, Pathogen density",
     xaxt='n', yaxt='n')
```

The linearised function has the general form $y = \beta_1 x + \beta_0$ which is a straight line. $y$ is the response variable, $x$ is the predictor variable, $\beta_1$ is the slope or gradient of the line, and $\beta_0$ is the intercept of the line. We will see this notation again in the lectures.

### Quiz

```{r quiz2}
quiz(
  question(
  "Which of these represents the slope of a general straight line?",
  answer("y"),
  answer("$\\beta_1$", correct = TRUE),
  answer("x"),
  answer("$\\beta_0$"),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
  question(
  "Which of these represents is the response variable of a general straight line?",
  answer("$\\beta_0$"),
  answer("y", correct = TRUE),
  answer("x"),
  answer("$\\beta_1$"),
  allow_retry = TRUE,
  random_answer_order = TRUE
))
```

This linear form allows us to estimate the coefficients for the linear equation where y = $\frac{1}{H_a}$ and x = $\frac{1}{H\times T_{total}}$.  

From the linearised Type II equation we can see that:  
$$Slope=\ \frac{1}{a}$$  
$$Intercept=\ \frac{T_h}{T_{total}}$$  

We can calculate the slope and intercept from regression and then do some algebra to find $a$ and $T_h$:  
$$a=\frac{1}{slope}$$ 
and
$$T_h = T_{total} \times intercept$$

Now we have our model, we can then ask "what if...?". What happens if we change things in the model? 

>For the rest of the practical we will look at the question:  
>**What happens to the number of pathogens a killer T cell can destroy when the number of pathogens in an area (the density) increases?**  

We can investigate this question with a simulation based experiment in Scratch, like in the previous practical. 

***

## The predator-prey Scratch simulation

In the previous practical you looked at building a Scratch model with a predator (a killer T cell) and some prey (invading pathogens). Your response variable was time taken to destroy all the pathogens and the predictor variable was the number of pathogens (pathogen density).

In this practical we have a slightly different experimental design. The predictor variable is the same but the response variable is the number of pathogens destroyed at the end of a fixed amount of time. We also have additional assumptions about functional responses that change how the simulation should behave - searching and handling prey are independent and mutually exclusive.

You don't have to modify the previous practical simulation yourself... I have done this for you.

You have been provided with a Scratch model you need to use to generate data for this practical and the next. This Scratch model is based on the previous practical but because our model of the biological system is more realistic and complex, our Scratch model is also more complex. You can compare the two and see what has changed.

You do not need to change any aspect of the predator sprite. When the predator eats a prey it will stop searching (moving) until it resumes searching. This behaviour is one of our model assumptions and is controlled by a variable called digesting but it's not important to track it.

Under the prey sprite tab you will see three code blocks arranged from top to bottom. They are:

* Top: Set prey density - the default is 20 but **this number needs to be changed because it's our predictor variable**, $H$
* Middle: Set up the counters and timer
    * prey_density is the number of pathogens our killer T cell has destroyed, $H_a$
    * digesting is the foraging state of the killer T cell, you can ignore this but it is an implementation of our assumptions that destroying and searching for pathogens are mutually exclusive activities
    * total_time is the duration of the infection response, $T_h$. When the timer reaches 0 or when all pathogens are destroyed, then the simulation will stop
* Bottom: This describes the behaviour of the pathogen. The pathogen will move around randomly until it touches the killer T cell. If the killer T cell is hungry, the pathogen is destroyed and the killer T cell becomes full (the digesting variable). If the killer T cell is full, then the pathogen lives.

When you click the green flag you will see two counters: a count down timer and the number of prey caught. The predator and prey sprites move around randomly within the fixed arena. The simulation stops when either the timer reaches 0 or when all prey are caught and the original prey density is displayed. Press the stop button to reset the simulation.

Now we have our research question and a model, we implicitly have our hypotheses. 

**Write down a null (H0) and alternative (H1) hypothesis before moving on to the next section.**

If you are not sure how to formulate a hypothesis, look back at previous material, then ask a demonstrator.

***

##

That's the end of Part A. Check in with your demonstrator. Take a break. Stand up. Shake your limbs. Breathe.

```{r break-quiz}
question(
  "Who lives in a pineapple under the sea?",
  answer("Spongebob Squarepants", correct = TRUE),
  answer("Patrick Star"),
  answer("Squidward Tentacles"),
  answer("Sandy Cheeks"),
  random_answer_order = TRUE
)
```

***

## Part B: Designing an experiment

### Hypotheses

How do your hypotheses compare to these?

H0: There is no relationship between pathogen density and number of pathogens destroyed  
H1: There is a positive linear relationship between pathogen density and number of pathogens destroyed

Notice how the hypotheses is worded and the language used. The alternative hypothesis describes the direction but not the strength of the relationship. If you are less certain about your predicted outcomes you could be less specific if you wanted to (e.g. not describing the direction of the relationship if the expected relationship could also be negative). There are no limits to how many hypotheses you have. You could have three hypotheses, a null and two alternatives - one for a positive relationship and one for a negative relationship.

**The wording of your hypothesis will dictate the best experimental design and statistical analysis to test your hypothesis! Choose wisely.**

> Remember, as scientists we never try to "prove" hypotheses. We aim to gather evidence and see whether the evidence supports our hypothesis.

It's good to be specific in your hypothesis if it is plausible in your biological system. For example, if we are testing whether a vaccine induces an immune response, the resulting immune response can only be positive - a negative immune response (i.e. becoming more susceptible to disease) is implausible (and unfortunate).

Keep your hypothesis as simple as possible to investigate what you are interested in, in your biological system. A more complex hypothesis means a more complex statistical analysis is needed.

Conducting a simple statistical analysis on a complex hypothesis and experimental design means that there is variation in your data that is not accounted for and could be affecting your response variable - it increases the chances of making a type II error (the meaningful biological relationship is hidden under statistical noise).

> When in doubt, keep it simple. 

***

### Identifying treatments 

We change the pathogen densities with each run of the simulation because it is the predictor variable. The different values of pathogen density is our treatment.

How many pathogen densities should you use? You need at least two treatments (two observations) to fit a straight line to data but there is no hard or fast rule for deciding these things. 

> Generally, the more treatments, the better your data may capture some true biological relationship. But more treatments means more work, time and effort!

**For the purpose of this practical, we will decide on 10 treatments of pathogen density. You are free to choose any 10 numbers from a range of 1 to 100.** 

We aim for consistency so your treatments should be equally spaced out. For example, in increments of 10.

***

### Replication, replication, replication

Replication is really important to increase the accuracy and precision of our data. It also reduces the chances of making a type 1 or type 2 error. 

> Generally, the more replication the better! Again, the trade-off is more work, time, effort or computing power.

**For the purpose of this practical, we will use 3 replicates of pathogen density.** Three is usually a minimum number of replications. In a real-world scientific study, you may have see higher replications.  

A replication of 3 means that we need to repeat our experiment three times for every value of the treatment. 

***

### Identifying constant parameters

In our experiment we have 1 killer T cell moving at a constant speed. This is a constant that does not change - doing so would violate the assumptions of our model.

Total immune response time is another constant. For simplicity, we will use a value of **1 minute** only so that we can divide by 1 and it makes our maths easier.

The number of killer T cells, speed and total time are all *parameters* and they are *constant* in a single simulation. Changing these would fundamentally change the experimental design and hypotheses tested. Changing these but keeping our hypotheses the same would be introducing additional variation into our data and increase the chance of making a type 2 error.

> Remember: keep it simple! Scientists try to control as many influential factors as possible in an experiment to make sure what they observe is the true effect of what they are seeking.

***
##

```{r quiz3}
quiz(caption = "Have you been paying attention?",
  question_text(
    paste("How many treatments are we using?"),
    answer("10", correct = TRUE),
    allow_retry = TRUE
  ),
  question_text(
    paste("How many replications are we using?"),
    answer("3", correct = TRUE),
    allow_retry = TRUE
  ),
  question_text(
    paste("How many hypotheses are we testing?"),
    answer("2", correct = TRUE),
    allow_retry = TRUE
  ),
  question_text(
    paste("Thus, how many observations should our data set contain?"),
    answer("30", correct = TRUE),
    allow_retry = TRUE
  )
)
```

***

### What if...?

That's not all we want to do today!

> Another use of statistical models is to explore different scenarios that represent different hypotheses.

What happens if our killer T cell was more efficient? For example, vaccines provide a chance for the immune system to "learn" how to destroy pathogens (e.g. viruses). After this experience, immune systems become more efficient at destroying pathogens. *How would this affect our results and the estimates of $a$ and $T_h$?*

The efficiency of the killer T cell is set as a variable in Scratch called `efficiency`. The **default value is 1** that is a constant in our simulation - it doesn't change and applies to all runs of the simulation. Let's call our original killer T cell an **unvaccinated individual**.

Now let's consider a **vaccinated individual**. Their killer T cells are more efficient, let's say twice as efficient. In this case, the value of `efficiency` is now 0.5. This is still a constant, it doesn't fundamentally change our model assumptions but becomes a new variable. 


If we want to compare the immune response between unvaccinated and vaccinated individuals, we need to run the experiment again *keeping everything the same but changing only the variable of interest*.

```{r genotype-quiz}
question(
  "Which of these variables do we change?",
  answer("Killer T cell efficiency", correct = TRUE),
  answer("The number of killer T cells"),
  answer("Pathogen density"),
  answer("Pathogens destroyed"),
  random_answer_order = TRUE,
  allow_retry = TRUE
)
```

In addition to the hypotheses before, we have two new hypotheses:

H0: There is no difference in the number of pathogens destroyed with pathogen density between vaccinated and unvaccinated individuals    
H1: There is a difference in the number of pathogens destroyed with pathogen density between vaccinated and unvaccinated individuals

We can formulate a more specific alternative hypothesis:

H1: Killer T cells of vaccinated individuals will destroy more pathogens than killer T cells of unvaccinated individuals. 

So we need to expand our dataset. We can add more observations to our first dataset and a new column denoting whether the individual is vaccinated or unvaccinated.

```{r nrow}
quiz(question_text(
    paste("Thus, how many observations should our final data set contain?"),
    answer("60", correct = TRUE, message = "All other variables and constants stay the same"),
    allow_retry = TRUE
  ),
  question_text(
    paste("How many response variables do we have?"),
    answer("1", correct = TRUE),
    allow_retry = TRUE
  ),
  question_text(
    paste("How many predictor variables do we have?"),
    answer("2", correct = TRUE, message = "Pathogen density and vaccination status"),
    allow_retry = TRUE
  )
)
```


##

That's the end of Part B. We have designed an experiment and identified our hypotheses.  

> Take a break. Check in with your demonstrator. Stand up. Shake your limbs. Breathe.

```{r break-quiz2}
question_radio(
  "Who won the 1932 Great Australian Emu War?",
  answer("The Emus", correct = TRUE, message = "All hail the emu overlords!"),
  answer("The Australian Army"),
  incorrect = "All hail the emu overlords!"
  )
```

***

## Part C: Collecting data

Planning about collecting data *before* collecting any data will save you a lot of headache if you realise halfway through that you've made a mistake and have to start over, or that there is a better, more efficient way of organising your data. Planning is everything.

Scientists often work in teams, which means that several people might collect data. This means that every person must collect data in a consistent way so that all the data can be aggregated. It also means that what information to collect and how it is stored or shared needs to be agreed on before anyone starts. One might also need to consider any laws or regulations for how data is collected (e.g. research ethics, privacy laws). 

Having a standardised data sheet and way of data entry is key to maintain consistency and minimise data loss.

### Tidy data

Tidy data is set of principles for organising data sheets and filling in data. It is designed in a way to make data analysis easier and reduces the amount of work require to *prepare* your data for analysis.

In short: 

 * Every column is a variable
 * Every row is an observation

You can read about tidy data [here](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html).

### Filling in a data sheet 

Here are the rules we want you to apply here (these are not global standards and may vary elsewhere):

 * CaSe coNsistEncy in all text
     * All words including column headers should be in lower case, no spaces
 * Column headers should be informative
     * `pathogen_density` or `total_time` is good (even the mathematical notation like `H` or `Th` because it is standardised)
     * `col1` or `pd` is bad - not easy to understand (e.g. acronyms not everyone uses)
 * No empty cells
     * All cells should have a value. Put `NA` if empty
     * Every cell is a single value
 * Do not mix alphanumeric characters (e.g. l3773r5 & numb3r5)
     * Numeric columns should only contain numbers (0-9), no letters. Character strings should only contain letters (a-z), no numbers
     * Avoid special characters (e.g. (), ~, &, / etc.)
 * No spaces
     * No spaces between words. Use _ instead. E.g. `no_spaces`
     * No spaces before or after words
     * This rule doesn't apply to generic text fields for taking notes or observations. It applies to treatments of a variable if they are described by strings, e.g. `no_fertiliser`, `yes_fertiliser`
 * Data is stored in rows and columns in a "long" tidy format
 * All data is presented together
     * Not in multiple sheets - use a separate file if you must.
 * Data is raw
     * Meaning it is not manipulated or processed after being recorded. We will do any data processing in `R` next prac
     * All data is presented, not summarised. E.g. as means 
 * Data is presented in a portable csv format
     * Not everyone has access to Excel. What if someone uses Google Sheets? ".xlsx" files are for Excel. 
     * ".csv", comma separated files are portable across platforms, use less memory and are easy for a computer to read - save your data in this format
 * Are all the necessary columns/information included and in the right order?
     * The order doesn't always matter but in this case it does for the automatic checking script
     
Your datasheet will be marked pass/fail against these rules. It has to meet all of these criteria to pass.

***

#### Database lingo

When data is imported into a computer, the computer will classify it according to the type of data. Here are some common data types:

 * numeric - fields or cells that only contain numbers
 * string - strings of characters, i.e. text. Can be letters and numbers. Called `character` in `R`
 * date - for dates
 * logical - for logical statements, e.g. TRUE/FALSE
 
These are the main data classes characterised by `R`. There may be other types in other programs (e.g. Access, SQL). In computer science, "fields" are like variables (i.e. columns) in `R`, so "predator density" and "total time" are fields.

***

### Do your experiment & collect your data

See the table below for an example of column headers with no spaces and all cells with a single value. These are the information you need to provide in your datasheet and the type of data they are:

| column_information            	| information_type 	| description 	|
|-------------------------------	|------------------	|-------------	|
| student number                	| numeric          	| for marking 	|
| total time 	                    | numeric          	| in minutes  	|
| pathogen density              	| numeric          	| NA          	|
| replicate                     	| numeric          	| NA          	|
| pathogens destroyed           	| numeric          	| NA          	|
| vaccination status            	| character        	| `no` or `yes`	|

Save your datasheet as an csv file (in Excel, click "Save As" and select csv file type). Include your student number at the start of the file name. 

> The order of columns has to exactly match the order in the table. Your exact column header names can be different as long as they follow the critera above (lowercase, no spaces, informative). 

Now you can do your experiment and record your data. 

```{r radio1, echo = FALSE}
question_radio(
  "What is the R function to see an array of your column names?",
  answer("names()", correct = TRUE),
  answer("header()"),
  allow_retry = TRUE
)
```

***

### Uploading your dataset to Blackboard

Upload your data sheet **as a csv file** to the assignment link provided on Blackboard.

Your submission will be assigned a mark of 1 or 0 depending on whether it meets the criteria for standardised data above. That is, does it pass a quality check? So, make sure your student number is a column.

```{r radio2, echo = FALSE}
question_radio(
  "Why do we prefer to use comma separated values files?",
  answer("They save data in a easy to read format with less data loss and smaller file sizes", correct = TRUE),
  answer("They save lots of metadata like colour or font formatting"),
  allow_retry = TRUE
)
```

### Data cleaning

In data science, data usually needs to be processed before we can use it. The data needs to be checked and validated. Are all the field entered correctly? Attention to detail is important in case it introduces mistakes in our data that may bias our analyses!

Checking and correcting data is called **cleaning**. We take raw data and clean it up. Sometimes data cannot be fixed (e.g. errors of unknown origin), then the conservative approach is to exclude the observation which is a shame if lots of time and effort went in to collecting it.

In the real world, data is almost never clean and cleaning often takes longer than the actual analysis! Luckily, you won't need to do it for this prac. This is partly why we want to be particular with recording data.

Here is an example of a function that would check the data criteria (no promises that it's the same one used for marking). You have learnt about functions and if statements in `R` in your lectures already so you might be able to follow along (if not, don't worry - this is a more complex function than we would expect you to understand for this module):  

```
quality_check <- function(x, fail){
  pass <- 1

  # check for spaces in names
  if((sum(str_detect(names(x), " ")) != 0) == TRUE){pass <- 0}

  x <- as.data.frame(x)

  # check if numeric
  if(is(x[,1], "numeric") == FALSE){pass <- 0} # student no
  if((sum(x[,2] != 1) != 0) == TRUE) {pass <- 0}  # time
  if(is(x[,3], "numeric") == FALSE){pass <- 0} # pathogen density
  if(is(x[,4], "numeric") == FALSE){pass <- 0} # replication
  if(is(x[,5], "numeric") == FALSE){pass <- 0} # pathogens caught

  # check if character
  if(is(x[,6], "character") == FALSE){pass <- 0} # efficiency
  
  # check correct dimensions
  if(nrow(x) != 60){pass <- 0}
  if(length(x) != 6){pass <- 0}

  # check treatments and replications
  if(length(unique(x[,3])) != 10){pass <- 0}
  if(length(unique(x[,4])) != 3){pass <- 0}
  if(max(x[,3]) > 101){pass <- 0}

  # check lowercase
  if((sum(names(x) != tolower(names(x))) != 0) == TRUE){pass <- 0}
  if((sum(x[,6] != tolower(x[,7])) != 0) == TRUE){pass <- 0} # session
  
  # check complete
  if(sum(complete.cases(x)) != 60){pass <- 0}

  # which subset?
  if(fail == 0){ # remove if failed
    if(pass == 0){ x <- NULL}
  }
  if(fail == 1){ # remove if passed
    if(pass == 1){ x <- NULL}
  }
  
  return(x)

}
```


***

## Final checklist

> That's a wrap! Well done for making it to the end. Check in with your demonstrator.  
> Take a break. Stand up. Dance. Breathe.

One last recap quiz:

```{r hypo, echo = FALSE}
question("How many killer T cells are in our model?",
         answer("0"),
         answer("1", correct = TRUE),
         answer("2"),
         answer("100"),
         allow_retry = TRUE)
```

***

To sum up, we:

* Composed a theoretic model of an infection response with known and unknown parameters. The model describes a set of hypotheses based on assumptions we have made about the infection response 
* Identified a biological question and hypothesis
* Designed an experiment with adequate treatments and replication
* Ran a simulation of a model and extracted data 
* Filled in a spreadsheet with data following the principles of tidy data

All of these steps are part of the scientific method and are relevant to your final assessment.


The scratch model is a computer simulation of a biological system - an infection response - that is used to generate data. The functional response is a statistical model of the infection response - a general theoretic model - that is used to formulate hypotheses about our biological system.  

In the next practical we will use another type of statistical models (a linear regression) to statistically describe the data we collect and test the hypotheses of our functional response model.


***

Use the following check list to make sure you have done everything you need for this practical.  
Have you:

* Uploaded your dataset to Blackboard?
* Found the link to the CA questions?

***

```{r radio3, echo = FALSE}
question_radio(
  "Are you going to do the CA?",
  answer("yes", correct = TRUE),
  answer("no", message = "Are you sure?"),
  allow_retry = TRUE)
```

If everyone follows the instructions, then all your datasets will be comparable and we can combine everyone's data into one giant (anonymised) dataset. Meaning more data to play with than if you had done it by yourself.

In the next practical we will be analysing the aggregated & anonymised class data set.

> Now do the CA - 9 questions, 1 mark for each question + 1 mark for a tidy data set, for a total of 10 possible marks.  
> Good luck!
